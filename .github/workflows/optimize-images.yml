#on:
#  workflow_dispatch:
#  push:
#    branches:
#      - main
#
#concurrency:
#  group: deploy-to-production
#  cancel-in-progress: true
#
#jobs:
#  push-to-production-branch:
#    environment:
#      name: production
#      url: https://kyivska-zefirka.netlify.app/
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v3
#      - run: git config user.name github-actions
#      - run: git config user.email github-actions@github.com
#
#      # Встановлення imgp для роботи з зображеннями
#      - uses: actions/setup-python@v4
#        with:
#          python-version: '3.10'
#      - run: sudo apt install imgp
#
#      # Оптимізація зображень
#      - run: imgp -x 800x0 -wrake ./public/images/
#      - run: git add -A
#      - run: "git diff-index --quiet HEAD || git commit -m 'perf(images): Оптимізовано зображення'"
#
#      # Створення мініатюр
#      - run: cp -r ./public/images/ ./public/thumbnails/
#      - run: imgp -x 300x0 -wrake ./public/thumbnails/
#      - run: git add -A
#      - run: "git diff-index --quiet HEAD || git commit -m 'perf(images): Згенеровано мініатюри'"
#
#      # Публікація в production
#      - run: git push origin main:production --force
name: Publish on GitHub Pages

on:
  push:
    branches: [ main ]

concurrency:
  group: deploy
  cancel-in-progress: true

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Clone repository
        uses: actions/checkout@v3

      - name: Setup Deno environment
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x

      - name: Cache Images
        id: cache-primes
        uses: actions/cache@v3
        with:
          path: _cache
          key: images

      - name: Build site
        run: deno task build

      - name: Setup Pages
        uses: actions/configure-pages@v2

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: '_site'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
